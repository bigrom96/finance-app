<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="theme-color" content="#1e40af">
    <title>üí∞ –ú–æ–∏ –§–∏–Ω–∞–Ω—Å—ã</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * {
            -webkit-tap-highlight-color: transparent;
            -webkit-touch-callout: none;
        }
        
        body {
            overscroll-behavior: none;
            -webkit-font-smoothing: antialiased;
            background: #f8fafc;
        }
        
        input, select, textarea {
            -webkit-appearance: none;
            appearance: none;
        }
        
        input[type="number"]::-webkit-inner-spin-button,
        input[type="number"]::-webkit-outer-spin-button {
            -webkit-appearance: none;
            margin: 0;
        }
        
        .modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
            padding: 20px;
            animation: fadeIn 0.2s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .modal-content {
            background: white;
            border-radius: 20px;
            max-width: 500px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from { transform: translateY(50px); opacity: 0; }
            to { transform: translateY(0); opacity: 1; }
        }

        .tab-button {
            flex: 1;
            padding: 12px 8px;
            font-weight: 600;
            transition: all 0.2s;
            font-size: 13px;
        }

        .tab-button.active {
            color: #1e40af;
            border-bottom: 3px solid #1e40af;
        }

        .account-card {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: 16px;
            padding: 16px;
            color: white;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .transaction-card {
            background: white;
            border-radius: 12px;
            padding: 16px;
            margin-bottom: 12px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            transition: all 0.2s;
        }

        .transaction-card:active {
            transform: scale(0.98);
        }

        .btn-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 14px 24px;
            border-radius: 12px;
            font-weight: 600;
            transition: all 0.2s;
            box-shadow: 0 4px 6px rgba(102, 126, 234, 0.3);
        }

        .btn-primary:active {
            transform: scale(0.95);
        }

        .btn-income {
            background: linear-gradient(135deg, #10b981 0%, #059669 100%);
            box-shadow: 0 4px 6px rgba(16, 185, 129, 0.3);
        }

        .btn-expense {
            background: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
            box-shadow: 0 4px 6px rgba(239, 68, 68, 0.3);
        }

        .btn-transfer {
            background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);
            box-shadow: 0 4px 6px rgba(245, 158, 11, 0.3);
        }

        .category-item {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 8px;
            transition: all 0.2s;
        }

        .category-item.selected {
            border-color: #667eea;
            background: #f0f4ff;
        }

        .stat-card {
            background: white;
            border-radius: 16px;
            padding: 20px;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        // –ù–∞—á–∞–ª—å–Ω—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏
        const INITIAL_CATEGORIES = [
            {
                id: 'products',
                name: '–ü—Ä–æ–¥—É–∫—Ç—ã',
                icon: 'üçî',
                type: 'expense',
                subcategories: [
                    { id: 'drinks', name: '–ù–∞–ø–∏—Ç–∫–∏', icon: 'ü•§' },
                    { id: 'sweets', name: '–°–ª–∞–¥–∫–æ–µ', icon: 'üç¨' },
                    { id: 'fruits', name: '–§—Ä—É–∫—Ç—ã', icon: 'üçé' },
                    { id: 'vegetables', name: '–û–≤–æ—â–∏', icon: 'ü•¨' },
                    { id: 'other', name: '–î—Ä—É–≥–æ–µ', icon: 'üçû' }
                ]
            },
            {
                id: 'transport',
                name: '–¢—Ä–∞–Ω—Å–ø–æ—Ä—Ç',
                icon: 'üöó',
                type: 'expense',
                subcategories: [
                    { id: 'taxi', name: '–¢–∞–∫—Å–∏', icon: 'üöï' },
                    { id: 'metro', name: '–ú–µ—Ç—Ä–æ', icon: 'üöá' },
                    { id: 'bus', name: '–ê–≤—Ç–æ–±—É—Å', icon: 'üöå' }
                ]
            },
            {
                id: 'utilities',
                name: '–ö–æ–º–º—É–Ω–∞–ª—å–Ω—ã–µ',
                icon: 'üè†',
                type: 'expense',
                subcategories: [
                    { id: 'water', name: '–í–æ–¥–∞', icon: 'üíß' },
                    { id: 'electricity', name: '–°–≤–µ—Ç', icon: '‚ö°' },
                    { id: 'gas', name: '–ì–∞–∑', icon: 'üî•' },
                    { id: 'trash', name: '–í—ã–≤–æ–∑ –º—É—Å–æ—Ä–∞', icon: 'üóëÔ∏è' }
                ]
            },
            {
                id: 'communication',
                name: '–°–≤—è–∑—å',
                icon: 'üì±',
                type: 'expense',
                subcategories: [
                    { id: 'mobile', name: '–ú–æ–±–∏–ª—å–Ω–∞—è —Å–≤—è–∑—å', icon: 'üì±' },
                    { id: 'internet', name: '–ò–Ω—Ç–µ—Ä–Ω–µ—Ç', icon: 'üåê' }
                ]
            },
            {
                id: 'clothing',
                name: '–û–¥–µ–∂–¥–∞',
                icon: 'üëï',
                type: 'expense',
                subcategories: [
                    { id: 'clothes', name: '–û–¥–µ–∂–¥–∞', icon: 'üëï' },
                    { id: 'shoes', name: '–û–±—É–≤—å', icon: 'üëü' },
                    { id: 'accessories', name: '–ê–∫—Å–µ—Å—Å—É–∞—Ä—ã', icon: 'üëú' }
                ]
            },
            {
                id: 'income',
                name: '–î–æ—Ö–æ–¥',
                icon: 'üíº',
                type: 'income',
                subcategories: [
                    { id: 'salary', name: '–ó–∞—Ä–ø–ª–∞—Ç–∞', icon: 'üí∞' },
                    { id: 'bonus', name: '–ü—Ä–µ–º–∏—è', icon: 'üéÅ' },
                    { id: 'freelance', name: '–ü–æ–¥—Ä–∞–±–æ—Ç–∫–∞', icon: 'üíª' },
                    { id: 'other_income', name: '–î—Ä—É–≥–æ–µ', icon: 'üíµ' }
                ]
            }
        ];

        // –ù–∞—á–∞–ª—å–Ω—ã–µ —Å—á–µ—Ç–∞
        const INITIAL_ACCOUNTS = [
            { id: 'cash', name: '–ù–∞–ª–∏—á–Ω—ã–µ', icon: 'üíµ', balance: 0, color: '#10b981' },
            { id: 'kaspi', name: 'Kaspi Bank', icon: 'üîµ', balance: 0, color: '#3b82f6' },
            { id: 'bcc', name: '–ë–¶–ö', icon: 'üü¢', balance: 0, color: '#10b981' },
            { id: 'halyk', name: '–•–∞–ª—ã–∫ –ë–∞–Ω–∫', icon: 'üî¥', balance: 0, color: '#ef4444' },
            { id: 'card1', name: '–ö–∞—Ä—Ç–∞ 1', icon: 'üí≥', balance: 0, color: '#8b5cf6' }
        ];

        function App() {
            const [activeTab, setActiveTab] = useState('home');
            const [categories, setCategories] = useState([]);
            const [accounts, setAccounts] = useState([]);
            const [transactions, setTransactions] = useState([]);
            
            // –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞
            const [showAddTransaction, setShowAddTransaction] = useState(false);
            const [transactionType, setTransactionType] = useState('expense'); // income, expense, transfer
            const [showCategoryManager, setShowCategoryManager] = useState(false);
            const [searchQuery, setSearchQuery] = useState('');
            const [filterCategory, setFilterCategory] = useState('all');
            const [filterAccount, setFilterAccount] = useState('all');
            const [filterMonth, setFilterMonth] = useState('current');

            // –§–æ—Ä–º–∞ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
            const [txForm, setTxForm] = useState({
                amount: '',
                category: '',
                subcategory: '',
                account: '',
                toAccount: '',
                note: '',
                date: new Date().toISOString().split('T')[0]
            });

            // –ó–∞–≥—Ä—É–∑–∫–∞ –¥–∞–Ω–Ω—ã—Ö
            useEffect(() => {
                const savedCategories = localStorage.getItem('financeApp_categories');
                const savedAccounts = localStorage.getItem('financeApp_accounts');
                const savedTransactions = localStorage.getItem('financeApp_transactions');
                
                setCategories(savedCategories ? JSON.parse(savedCategories) : INITIAL_CATEGORIES);
                setAccounts(savedAccounts ? JSON.parse(savedAccounts) : INITIAL_ACCOUNTS);
                setTransactions(savedTransactions ? JSON.parse(savedTransactions) : []);
            }, []);

            // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
            useEffect(() => {
                if (categories.length > 0) {
                    localStorage.setItem('financeApp_categories', JSON.stringify(categories));
                }
            }, [categories]);

            useEffect(() => {
                if (accounts.length > 0) {
                    localStorage.setItem('financeApp_accounts', JSON.stringify(accounts));
                }
            }, [accounts]);

            useEffect(() => {
                localStorage.setItem('financeApp_transactions', JSON.stringify(transactions));
            }, [transactions]);

            // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏
            const addTransaction = () => {
                if (!txForm.amount || parseFloat(txForm.amount) <= 0) {
                    alert('–£–∫–∞–∂–∏—Ç–µ —Å—É–º–º—É');
                    return;
                }

                if (transactionType !== 'transfer' && !txForm.category) {
                    alert('–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é');
                    return;
                }

                if (!txForm.account) {
                    alert('–í—ã–±–µ—Ä–∏—Ç–µ —Å—á—ë—Ç');
                    return;
                }

                if (transactionType === 'transfer' && !txForm.toAccount) {
                    alert('–í—ã–±–µ—Ä–∏—Ç–µ —Å—á—ë—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª—è');
                    return;
                }

                if (transactionType === 'transfer' && txForm.account === txForm.toAccount) {
                    alert('–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞–∑–Ω—ã–µ —Å—á–µ—Ç–∞');
                    return;
                }

                const amount = parseFloat(txForm.amount);
                
                // –°–æ–∑–¥–∞—ë–º —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—é
                const transaction = {
                    id: Date.now(),
                    type: transactionType,
                    amount,
                    category: txForm.category,
                    subcategory: txForm.subcategory,
                    account: txForm.account,
                    toAccount: txForm.toAccount,
                    note: txForm.note,
                    date: txForm.date,
                    timestamp: new Date().toISOString()
                };

                // –û–±–Ω–æ–≤–ª—è–µ–º –±–∞–ª–∞–Ω—Å—ã
                setAccounts(prev => prev.map(acc => {
                    if (transactionType === 'income' && acc.id === txForm.account) {
                        return { ...acc, balance: acc.balance + amount };
                    }
                    if (transactionType === 'expense' && acc.id === txForm.account) {
                        return { ...acc, balance: acc.balance - amount };
                    }
                    if (transactionType === 'transfer') {
                        if (acc.id === txForm.account) {
                            return { ...acc, balance: acc.balance - amount };
                        }
                        if (acc.id === txForm.toAccount) {
                            return { ...acc, balance: acc.balance + amount };
                        }
                    }
                    return acc;
                }));

                setTransactions(prev => [transaction, ...prev]);
                setShowAddTransaction(false);
                setTxForm({
                    amount: '',
                    category: '',
                    subcategory: '',
                    account: '',
                    toAccount: '',
                    note: '',
                    date: new Date().toISOString().split('T')[0]
                });
            };

            // –†–∞—Å—á—ë—Ç—ã
            const calculations = useMemo(() => {
                const totalBalance = accounts.reduce((sum, acc) => sum + acc.balance, 0);
                
                const currentMonth = new Date().getMonth();
                const currentYear = new Date().getFullYear();
                
                const monthTransactions = transactions.filter(tx => {
                    const txDate = new Date(tx.date);
                    return txDate.getMonth() === currentMonth && txDate.getFullYear() === currentYear;
                });

                const monthIncome = monthTransactions
                    .filter(tx => tx.type === 'income')
                    .reduce((sum, tx) => sum + tx.amount, 0);

                const monthExpenses = monthTransactions
                    .filter(tx => tx.type === 'expense')
                    .reduce((sum, tx) => sum + tx.amount, 0);

                // –†–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
                const expensesByCategory = {};
                monthTransactions
                    .filter(tx => tx.type === 'expense')
                    .forEach(tx => {
                        const cat = categories.find(c => c.id === tx.category);
                        if (cat) {
                            if (!expensesByCategory[cat.name]) {
                                expensesByCategory[cat.name] = { amount: 0, icon: cat.icon };
                            }
                            expensesByCategory[cat.name].amount += tx.amount;
                        }
                    });

                return {
                    totalBalance,
                    monthIncome,
                    monthExpenses,
                    monthBalance: monthIncome - monthExpenses,
                    expensesByCategory
                };
            }, [accounts, transactions, categories]);

            // –§–∏–ª—å—Ç—Ä–∞—Ü–∏—è —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–π
            const filteredTransactions = useMemo(() => {
                let result = [...transactions];

                // –ü–æ–∏—Å–∫
                if (searchQuery) {
                    result = result.filter(tx => 
                        tx.note?.toLowerCase().includes(searchQuery.toLowerCase()) ||
                        accounts.find(a => a.id === tx.account)?.name.toLowerCase().includes(searchQuery.toLowerCase())
                    );
                }

                // –ö–∞—Ç–µ–≥–æ—Ä–∏—è
                if (filterCategory !== 'all') {
                    result = result.filter(tx => tx.category === filterCategory);
                }

                // –°—á—ë—Ç
                if (filterAccount !== 'all') {
                    result = result.filter(tx => tx.account === filterAccount || tx.toAccount === filterAccount);
                }

                // –ú–µ—Å—è—Ü
                if (filterMonth === 'current') {
                    const currentMonth = new Date().getMonth();
                    const currentYear = new Date().getFullYear();
                    result = result.filter(tx => {
                        const txDate = new Date(tx.date);
                        return txDate.getMonth() === currentMonth && txDate.getFullYear() === currentYear;
                    });
                }

                return result;
            }, [transactions, searchQuery, filterCategory, filterAccount, filterMonth, accounts]);

            // –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –¥–∞—Ç–∞–º
            const groupedTransactions = useMemo(() => {
                const groups = {};
                filteredTransactions.forEach(tx => {
                    const date = new Date(tx.date).toLocaleDateString('ru-RU', {
                        day: 'numeric',
                        month: 'long',
                        year: 'numeric'
                    });
                    if (!groups[date]) {
                        groups[date] = [];
                    }
                    groups[date].push(tx);
                });
                return groups;
            }, [filteredTransactions]);

            // –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
            const TransactionModal = () => {
                const selectedCategory = categories.find(c => c.id === txForm.category);

                return (
                    <div className="modal-overlay" onClick={() => setShowAddTransaction(false)}>
                        <div className="modal-content" onClick={(e) => e.stopPropagation()}>
                            <div className="p-6">
                                <h2 className="text-2xl font-bold mb-4">
                                    {transactionType === 'income' ? 'üí∞ –î–æ—Ö–æ–¥' : 
                                     transactionType === 'expense' ? 'üí∏ –†–∞—Å—Ö–æ–¥' : 'üîÑ –ü–µ—Ä–µ–≤–æ–¥'}
                                </h2>

                                <div className="space-y-4">
                                    {/* –°—É–º–º–∞ */}
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">–°—É–º–º–∞ (‚Ç∏)</label>
                                        <input
                                            type="number"
                                            value={txForm.amount}
                                            onChange={(e) => setTxForm({...txForm, amount: e.target.value})}
                                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl text-lg font-semibold focus:border-blue-500 focus:outline-none"
                                            placeholder="0"
                                        />
                                    </div>

                                    {/* –ö–∞—Ç–µ–≥–æ—Ä–∏—è */}
                                    {transactionType !== 'transfer' && (
                                        <>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-2">–ö–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                                                <select
                                                    value={txForm.category}
                                                    onChange={(e) => setTxForm({...txForm, category: e.target.value, subcategory: ''})}
                                                    className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none"
                                                >
                                                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—é</option>
                                                    {categories
                                                        .filter(c => c.type === transactionType)
                                                        .map(cat => (
                                                            <option key={cat.id} value={cat.id}>
                                                                {cat.icon} {cat.name}
                                                            </option>
                                                        ))}
                                                </select>
                                            </div>

                                            {/* –ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è */}
                                            {selectedCategory?.subcategories && (
                                                <div>
                                                    <label className="block text-sm font-medium text-gray-700 mb-2">–ü–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏—è</label>
                                                    <select
                                                        value={txForm.subcategory}
                                                        onChange={(e) => setTxForm({...txForm, subcategory: e.target.value})}
                                                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none"
                                                    >
                                                        <option value="">–ù–µ —É–∫–∞–∑–∞–Ω–∞</option>
                                                        {selectedCategory.subcategories.map(sub => (
                                                            <option key={sub.id} value={sub.id}>
                                                                {sub.icon} {sub.name}
                                                            </option>
                                                        ))}
                                                    </select>
                                                </div>
                                            )}
                                        </>
                                    )}

                                    {/* –°—á—ë—Ç */}
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">
                                            {transactionType === 'transfer' ? '–û—Ç–∫—É–¥–∞' : '–°—á—ë—Ç'}
                                        </label>
                                        <select
                                            value={txForm.account}
                                            onChange={(e) => setTxForm({...txForm, account: e.target.value})}
                                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none"
                                        >
                                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—á—ë—Ç</option>
                                            {accounts.map(acc => (
                                                <option key={acc.id} value={acc.id}>
                                                    {acc.icon} {acc.name} ({acc.balance.toLocaleString()}‚Ç∏)
                                                </option>
                                            ))}
                                        </select>
                                    </div>

                                    {/* –°—á—ë—Ç –ø–æ–ª—É—á–∞—Ç–µ–ª—è (–¥–ª—è –ø–µ—Ä–µ–≤–æ–¥–∞) */}
                                    {transactionType === 'transfer' && (
                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-2">–ö—É–¥–∞</label>
                                            <select
                                                value={txForm.toAccount}
                                                onChange={(e) => setTxForm({...txForm, toAccount: e.target.value})}
                                                className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none"
                                            >
                                                <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Å—á—ë—Ç</option>
                                                {accounts.filter(a => a.id !== txForm.account).map(acc => (
                                                    <option key={acc.id} value={acc.id}>
                                                        {acc.icon} {acc.name} ({acc.balance.toLocaleString()}‚Ç∏)
                                                    </option>
                                                ))}
                                            </select>
                                        </div>
                                    )}

                                    {/* –î–∞—Ç–∞ */}
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">–î–∞—Ç–∞</label>
                                        <input
                                            type="date"
                                            value={txForm.date}
                                            onChange={(e) => setTxForm({...txForm, date: e.target.value})}
                                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none"
                                        />
                                    </div>

                                    {/* –ó–∞–º–µ—Ç–∫–∞ */}
                                    <div>
                                        <label className="block text-sm font-medium text-gray-700 mb-2">–ó–∞–º–µ—Ç–∫–∞ (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                                        <textarea
                                            value={txForm.note}
                                            onChange={(e) => setTxForm({...txForm, note: e.target.value})}
                                            className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl focus:border-blue-500 focus:outline-none resize-none"
                                            rows="3"
                                            placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –ö—É–ø–∏–ª –≤ –ú–∞–≥–Ω—É–º–µ"
                                        />
                                    </div>
                                </div>

                                <div className="flex gap-3 mt-6">
                                    <button
                                        onClick={addTransaction}
                                        className="flex-1 btn-primary"
                                    >
                                        –î–æ–±–∞–≤–∏—Ç—å
                                    </button>
                                    <button
                                        onClick={() => setShowAddTransaction(false)}
                                        className="flex-1 bg-gray-200 text-gray-700 py-3 px-6 rounded-xl font-semibold"
                                    >
                                        –û—Ç–º–µ–Ω–∞
                                    </button>
                                </div>
                            </div>
                        </div>
                    </div>
                );
            };

            const HomeTab = () => (
                <div className="p-4 pb-32">
                    {/* –û–±—â–∏–π –±–∞–ª–∞–Ω—Å */}
                    <div className="account-card mb-6">
                        <p className="text-sm opacity-90 mb-1">–û–±—â–∏–π –±–∞–ª–∞–Ω—Å</p>
                        <p className="text-4xl font-bold">{calculations.totalBalance.toLocaleString()} ‚Ç∏</p>
                    </div>

                    {/* –ú–µ—Å—è—á–Ω–∞—è —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ */}
                    <div className="bg-white rounded-xl p-4 mb-6 shadow-sm">
                        <h3 className="font-semibold text-gray-700 mb-3">–≠—Ç–æ—Ç –º–µ—Å—è—Ü</h3>
                        <div className="space-y-2">
                            <div className="flex justify-between items-center">
                                <span className="text-gray-600">üí∞ –î–æ—Ö–æ–¥—ã</span>
                                <span className="font-semibold text-green-600">+{calculations.monthIncome.toLocaleString()} ‚Ç∏</span>
                            </div>
                            <div className="flex justify-between items-center">
                                <span className="text-gray-600">üí∏ –†–∞—Å—Ö–æ–¥—ã</span>
                                <span className="font-semibold text-red-600">-{calculations.monthExpenses.toLocaleString()} ‚Ç∏</span>
                            </div>
                            <div className="border-t pt-2 mt-2">
                                <div className="flex justify-between items-center">
                                    <span className="font-semibold text-gray-700">–ë–∞–ª–∞–Ω—Å</span>
                                    <span className={`font-bold text-lg ${calculations.monthBalance >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                                        {calculations.monthBalance >= 0 ? '+' : ''}{calculations.monthBalance.toLocaleString()} ‚Ç∏
                                    </span>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* –°—á–µ—Ç–∞ */}
                    <h3 className="font-bold text-lg mb-3 text-gray-800">–ú–æ–∏ —Å—á–µ—Ç–∞</h3>
                    <div className="space-y-3 mb-6">
                        {accounts.map(acc => (
                            <div key={acc.id} className="bg-white rounded-xl p-4 shadow-sm flex items-center justify-between">
                                <div className="flex items-center gap-3">
                                    <div className="text-3xl">{acc.icon}</div>
                                    <div>
                                        <p className="font-semibold text-gray-800">{acc.name}</p>
                                    </div>
                                </div>
                                <p className="font-bold text-lg" style={{color: acc.color}}>
                                    {acc.balance.toLocaleString()} ‚Ç∏
                                </p>
                            </div>
                        ))}
                    </div>

                    {/* –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π */}
                    <div className="grid grid-cols-3 gap-3 mb-6">
                        <button
                            onClick={() => {
                                setTransactionType('income');
                                setShowAddTransaction(true);
                            }}
                            className="btn-primary btn-income text-sm py-4"
                        >
                            <div>‚ûï</div>
                            <div className="mt-1">–î–æ—Ö–æ–¥</div>
                        </button>
                        <button
                            onClick={() => {
                                setTransactionType('expense');
                                setShowAddTransaction(true);
                            }}
                            className="btn-primary btn-expense text-sm py-4"
                        >
                            <div>‚ûñ</div>
                            <div className="mt-1">–†–∞—Å—Ö–æ–¥</div>
                        </button>
                        <button
                            onClick={() => {
                                setTransactionType('transfer');
                                setShowAddTransaction(true);
                            }}
                            className="btn-primary btn-transfer text-sm py-4"
                        >
                            <div>üîÑ</div>
                            <div className="mt-1">–ü–µ—Ä–µ–≤–æ–¥</div>
                        </button>
                    </div>

                    {/* –ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ */}
                    <h3 className="font-bold text-lg mb-3 text-gray-800">–ü–æ—Å–ª–µ–¥–Ω–∏–µ –æ–ø–µ—Ä–∞—Ü–∏–∏</h3>
                    {transactions.slice(0, 5).map(tx => {
                        const cat = categories.find(c => c.id === tx.category);
                        const subcat = cat?.subcategories?.find(s => s.id === tx.subcategory);
                        const acc = accounts.find(a => a.id === tx.account);
                        const toAcc = accounts.find(a => a.id === tx.toAccount);

                        return (
                            <div key={tx.id} className="transaction-card">
                                <div className="flex items-start justify-between">
                                    <div className="flex items-start gap-3 flex-1">
                                        <div className="text-2xl">
                                            {tx.type === 'transfer' ? 'üîÑ' : cat?.icon || 'üí∞'}
                                        </div>
                                        <div className="flex-1">
                                            <p className="font-semibold text-gray-800">
                                                {tx.type === 'transfer' ? 
                                                    `${acc?.name} ‚Üí ${toAcc?.name}` :
                                                    `${cat?.name}${subcat ? ` ‚Üí ${subcat.name}` : ''}`
                                                }
                                            </p>
                                            {tx.note && <p className="text-sm text-gray-500 mt-1">"{tx.note}"</p>}
                                            <p className="text-xs text-gray-400 mt-1">
                                                {new Date(tx.date).toLocaleDateString('ru-RU')} ‚Ä¢ {acc?.name}
                                            </p>
                                        </div>
                                    </div>
                                    <div className={`font-bold text-lg ${tx.type === 'income' ? 'text-green-600' : 'text-red-600'}`}>
                                        {tx.type === 'income' ? '+' : '-'}{tx.amount.toLocaleString()} ‚Ç∏
                                    </div>
                                </div>
                            </div>
                        );
                    })}
                </div>
            );

            const HistoryTab = () => (
                <div className="p-4 pb-32">
                    {/* –ü–æ–∏—Å–∫ */}
                    <input
                        type="text"
                        placeholder="üîç –ü–æ–∏—Å–∫..."
                        value={searchQuery}
                        onChange={(e) => setSearchQuery(e.target.value)}
                        className="w-full px-4 py-3 border-2 border-gray-200 rounded-xl mb-4 focus:border-blue-500 focus:outline-none"
                    />

                    {/* –§–∏–ª—å—Ç—Ä—ã */}
                    <div className="grid grid-cols-3 gap-2 mb-4">
                        <select
                            value={filterCategory}
                            onChange={(e) => setFilterCategory(e.target.value)}
                            className="px-3 py-2 border-2 border-gray-200 rounded-xl text-sm focus:border-blue-500 focus:outline-none"
                        >
                            <option value="all">–í—Å–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏</option>
                            {categories.map(cat => (
                                <option key={cat.id} value={cat.id}>{cat.icon} {cat.name}</option>
                            ))}
                        </select>

                        <select
                            value={filterAccount}
                            onChange={(e) => setFilterAccount(e.target.value)}
                            className="px-3 py-2 border-2 border-gray-200 rounded-xl text-sm focus:border-blue-500 focus:outline-none"
                        >
                            <option value="all">–í—Å–µ —Å—á–µ—Ç–∞</option>
                            {accounts.map(acc => (
                                <option key={acc.id} value={acc.id}>{acc.icon} {acc.name}</option>
                            ))}
                        </select>

                        <select
                            value={filterMonth}
                            onChange={(e) => setFilterMonth(e.target.value)}
                            className="px-3 py-2 border-2 border-gray-200 rounded-xl text-sm focus:border-blue-500 focus:outline-none"
                        >
                            <option value="current">–≠—Ç–æ—Ç –º–µ—Å—è—Ü</option>
                            <option value="all">–í—Å—ë –≤—Ä–µ–º—è</option>
                        </select>
                    </div>

                    {/* –°–ø–∏—Å–æ–∫ –æ–ø–µ—Ä–∞—Ü–∏–π */}
                    {Object.entries(groupedTransactions).map(([date, txs]) => (
                        <div key={date} className="mb-6">
                            <p className="text-sm font-semibold text-gray-500 mb-2">{date}</p>
                            {txs.map(tx => {
                                const cat = categories.find(c => c.id === tx.category);
                                const subcat = cat?.subcategories?.find(s => s.id === tx.subcategory);
                                const acc = accounts.find(a => a.id === tx.account);
                                const toAcc = accounts.find(a => a.id === tx.toAccount);

                                return (
                                    <div key={tx.id} className="transaction-card">
                                        <div className="flex items-start justify-between">
                                            <div className="flex items-start gap-3 flex-1">
                                                <div className="text-2xl">
                                                    {tx.type === 'transfer' ? 'üîÑ' : cat?.icon || 'üí∞'}
                                                </div>
                                                <div className="flex-1">
                                                    <p className="font-semibold text-gray-800">
                                                        {tx.type === 'transfer' ? 
                                                            `${acc?.name} ‚Üí ${toAcc?.name}` :
                                                            `${cat?.name}${subcat ? ` ‚Üí ${subcat.name}` : ''}`
                                                        }
                                                    </p>
                                                    {tx.note && <p className="text-sm text-gray-500 mt-1">"{tx.note}"</p>}
                                                    <p className="text-xs text-gray-400 mt-1">
                                                        {new Date(tx.timestamp).toLocaleTimeString('ru-RU', {hour: '2-digit', minute: '2-digit'})} ‚Ä¢ {acc?.name}
                                                    </p>
                                                </div>
                                            </div>
                                            <div className={`font-bold text-lg ${tx.type === 'income' ? 'text-green-600' : 'text-red-600'}`}>
                                                {tx.type === 'income' ? '+' : '-'}{tx.amount.toLocaleString()} ‚Ç∏
                                            </div>
                                        </div>
                                    </div>
                                );
                            })}
                        </div>
                    ))}

                    {filteredTransactions.length === 0 && (
                        <div className="text-center py-12 text-gray-400">
                            <p className="text-4xl mb-2">üì≠</p>
                            <p>–ù–µ—Ç –æ–ø–µ—Ä–∞—Ü–∏–π</p>
                        </div>
                    )}
                </div>
            );

            const StatsTab = () => (
                <div className="p-4 pb-32">
                    <h2 className="text-2xl font-bold mb-4">–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞</h2>
                    
                    <div className="stat-card mb-6">
                        <h3 className="font-semibold text-gray-700 mb-4">
                            {new Date().toLocaleDateString('ru-RU', { month: 'long', year: 'numeric' })}
                        </h3>
                        
                        <div className="space-y-3 mb-4">
                            <div className="flex justify-between items-center py-2 border-b">
                                <span className="text-gray-600">üí∞ –î–æ—Ö–æ–¥—ã</span>
                                <span className="font-bold text-green-600 text-lg">+{calculations.monthIncome.toLocaleString()} ‚Ç∏</span>
                            </div>
                            <div className="flex justify-between items-center py-2 border-b">
                                <span className="text-gray-600">üí∏ –†–∞—Å—Ö–æ–¥—ã</span>
                                <span className="font-bold text-red-600 text-lg">-{calculations.monthExpenses.toLocaleString()} ‚Ç∏</span>
                            </div>
                            <div className="flex justify-between items-center py-2">
                                <span className="font-semibold text-gray-700">–ë–∞–ª–∞–Ω—Å</span>
                                <span className={`font-bold text-xl ${calculations.monthBalance >= 0 ? 'text-green-600' : 'text-red-600'}`}>
                                    {calculations.monthBalance >= 0 ? '+' : ''}{calculations.monthBalance.toLocaleString()} ‚Ç∏
                                </span>
                            </div>
                        </div>
                    </div>

                    <div className="stat-card">
                        <h3 className="font-semibold text-gray-700 mb-4">–†–∞—Å—Ö–æ–¥—ã –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º</h3>
                        
                        {Object.entries(calculations.expensesByCategory).length > 0 ? (
                            <div className="space-y-3">
                                {Object.entries(calculations.expensesByCategory)
                                    .sort((a, b) => b[1].amount - a[1].amount)
                                    .map(([name, data]) => {
                                        const percentage = ((data.amount / calculations.monthExpenses) * 100).toFixed(0);
                                        return (
                                            <div key={name}>
                                                <div className="flex justify-between items-center mb-1">
                                                    <span className="text-sm text-gray-600">{data.icon} {name}</span>
                                                    <span className="font-semibold">{data.amount.toLocaleString()} ‚Ç∏ ({percentage}%)</span>
                                                </div>
                                                <div className="w-full bg-gray-200 rounded-full h-2">
                                                    <div 
                                                        className="bg-gradient-to-r from-purple-500 to-blue-500 h-2 rounded-full"
                                                        style={{width: `${percentage}%`}}
                                                    />
                                                </div>
                                            </div>
                                        );
                                    })}
                            </div>
                        ) : (
                            <p className="text-center text-gray-400 py-8">–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –∑–∞ —ç—Ç–æ—Ç –º–µ—Å—è—Ü</p>
                        )}
                    </div>
                </div>
            );

            const SettingsTab = () => (
                <div className="p-4 pb-32">
                    <h2 className="text-2xl font-bold mb-4">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>

                    <div className="space-y-3">
                        <button className="w-full bg-white rounded-xl p-4 shadow-sm text-left flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <span className="text-2xl">üìÇ</span>
                                <span className="font-semibold">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º–∏</span>
                            </div>
                            <span className="text-gray-400">‚Üí</span>
                        </button>

                        <button className="w-full bg-white rounded-xl p-4 shadow-sm text-left flex items-center justify-between">
                            <div className="flex items-center gap-3">
                                <span className="text-2xl">üí≥</span>
                                <span className="font-semibold">–£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —Å—á–µ—Ç–∞–º–∏</span>
                            </div>
                            <span className="text-gray-400">‚Üí</span>
                        </button>

                        <button 
                            onClick={() => {
                                if (confirm('–í—ã —É–≤–µ—Ä–µ–Ω—ã? –í—Å–µ –¥–∞–Ω–Ω—ã–µ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã!')) {
                                    setAccounts(INITIAL_ACCOUNTS);
                                    setTransactions([]);
                                    setCategories(INITIAL_CATEGORIES);
                                }
                            }}
                            className="w-full bg-white rounded-xl p-4 shadow-sm text-left flex items-center justify-between border-2 border-red-200"
                        >
                            <div className="flex items-center gap-3">
                                <span className="text-2xl">üóëÔ∏è</span>
                                <span className="font-semibold text-red-600">–°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</span>
                            </div>
                        </button>
                    </div>

                    <div className="mt-8 text-center text-sm text-gray-400">
                        <p>üí∞ –ú–æ–∏ –§–∏–Ω–∞–Ω—Å—ã v1.0</p>
                        <p className="mt-1">–í—Å–µ –¥–∞–Ω–Ω—ã–µ —Ö—Ä–∞–Ω—è—Ç—Å—è –ª–æ–∫–∞–ª—å–Ω–æ –≤ –≤–∞—à–µ–º —Ç–µ–ª–µ—Ñ–æ–Ω–µ</p>
                    </div>
                </div>
            );

            return (
                <div className="min-h-screen bg-gray-50">
                    {/* –®–∞–ø–∫–∞ */}
                    <div className="bg-gradient-to-r from-blue-600 to-blue-800 text-white sticky top-0 z-10 shadow-lg">
                        <h1 className="text-2xl font-bold text-center pt-4 px-4">üí∞ –ú–æ–∏ –§–∏–Ω–∞–Ω—Å—ã</h1>
                        <p className="text-center text-sm opacity-90 pb-3">–£—á—ë—Ç –¥–æ—Ö–æ–¥–æ–≤ –∏ —Ä–∞—Å—Ö–æ–¥–æ–≤</p>
                        
                        {/* –¢–∞–±—ã */}
                        <div className="flex bg-blue-700 text-white">
                            <button
                                onClick={() => setActiveTab('home')}
                                className={`tab-button ${activeTab === 'home' ? 'active bg-gray-50' : ''}`}
                            >
                                üè† –ì–ª–∞–≤–Ω–∞—è
                            </button>
                            <button
                                onClick={() => setActiveTab('history')}
                                className={`tab-button ${activeTab === 'history' ? 'active bg-gray-50' : ''}`}
                            >
                                üìú –ò—Å—Ç–æ—Ä–∏—è
                            </button>
                            <button
                                onClick={() => setActiveTab('stats')}
                                className={`tab-button ${activeTab === 'stats' ? 'active bg-gray-50' : ''}`}
                            >
                                üìä –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
                            </button>
                            <button
                                onClick={() => setActiveTab('settings')}
                                className={`tab-button ${activeTab === 'settings' ? 'active bg-gray-50' : ''}`}
                            >
                                ‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏
                            </button>
                        </div>
                    </div>

                    {/* –ö–æ–Ω—Ç–µ–Ω—Ç */}
                    {activeTab === 'home' && <HomeTab />}
                    {activeTab === 'history' && <HistoryTab />}
                    {activeTab === 'stats' && <StatsTab />}
                    {activeTab === 'settings' && <SettingsTab />}

                    {/* –ú–æ–¥–∞–ª—å–Ω—ã–µ –æ–∫–Ω–∞ */}
                    {showAddTransaction && <TransactionModal />}
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
